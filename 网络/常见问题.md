# HTTP1.1（文本格式传输）

1. 对头阻塞问题，没有解决（保持连接）

2. 文本传输效率问题，而且不安全

3. header中每次都传输类似头，增加了传输成本

4. 慢启动是 TCP 为了减少网络拥塞的一种策略，我们是没有办法改变的（资源多的时候会卡顿）。
5. 多个TCP竞争带宽
6. 不够安全

http/1.1中的一个tcp链接同时只能发起一个http请求！

# HTTP2（流的）

- stream
- message http的消息，响应，请求，由一个或多个帧组成；
- frame【http2最小单位】 每个帧包含帧首部，至少会标识出当前帧所属的流（流标识），承载特定类型的数据；HTTP头部，payload；可以乱序发送，根据帧首部的流标识可以重装；
- 一个域名只维护一个TCP持久连接（减少带宽占用）；
- 可以设置请求的优先级
- 头部压缩
  

# HTTP3

- upd+quic
- 实现了类似 TCP 的流量控制、传输可靠性的功能。
- 集成了 TLS 加密功能。
- 实现了 HTTP/2 中的多路复用功能。
- 实现了快速握手功能


# TLS 三次握手

- `client hello`带上TLS版本、密码组合、client random
- `server hello`发送证书、server random；选择密码组合
- 使用RSA算法生成`premaster secret`+公钥 加密
- 服务端使用私钥揭秘得出`premaster secret`
- 服务端跟客户的同时使用`client random` `server random` `premaster secret` 生成共享密钥
- **客户端就绪：** 客户端发送经过共享密钥 **KEY**加密过的"finished"信号。
- **服务器就绪：** 服务器发送经过共享密钥 **KEY**加密过的"finished"信号。
- **达成安全通信：** 握手完成，双方使用对称加密进行安全通信。

# TCP 与UDP区别

只有通过IP地址、传输层协议和端口号三者才能在网络上定位到具体的服务，

## 端口号

端口号是主机和进程的中间层，进程和端口号即可以是一对一、一对多；端口号的引入可以让同时让主机上的多个进程对外提供服务，可以让一个进程对外提供多个服务；有了端口号，想要访问主机服务的请求也不需要通过进程进程标识符等方法定位服务的具体进程；

## 消息保护边界

传输协议把数据当作一条独立的消息在网络上传输，接收端只能接受独立的消息，也就是说存在保护消息边界，接收端一次只能接收发送端发出的一个数据包；

而`面向流`则是无消息保护边界，如果发送端连续发送数据，接收端一次接收动作中，会接收到两个或者更多的数据包；

**结论：**

 TCP为了数据的可靠传输，尽量减少额外开销（每次发包都要验证），因此采用了流式传输，面向流的传输，这样可以减少发送包的数量。对于接收端来讲，如果机器负载很重，使用TCP可能会容易`粘包`；因此需要额外拆包，增加了工作量，因此适合数据可靠性高，频率低的场合（两次操作100ms，具体由内核中的socket决定）；

而UDP发送的频率较高时，会增加系统（发送端、接收端）的开销；因此最好设置一个比较合适的数据包的包长（UDP最大载荷为1472，因此最好能够每次接近这个数据量，适合于视频，音频等大块数据的发送，同时减少握手来保证流媒体的实时性）；

TCP无保护消息边界的解决：（解决粘包）

- 发送固定长度的消息 （适合消息长度不是很长的情况）【！HTTP协议的消息边界就是基于content-length实现】
- 把消息的尺寸与消息一起发送
- 使用特殊标记来区分消息间隔【如果HTTP使用块传输，就会使用负载大小为0的HTTP消息作为终结符表示消息边界，当然使用TCP协议发送JSON消息，接收方可以通过是否解析成合法的JSON去判断消息是否终结】

## 丢包

- Linux内核socket缓冲区太小
- 服务器负载太高，占用大量cpu资源
- 磁盘IO忙【磁盘满】

## 协议头

- UDP 协议头中只包含4个字段：源端口、目标端口、长度和校验码；一个字段16个bit，所以一共8个字节（8bit = 4byte）「只包含了两个端口号的 UDP 协议本身是无法提供路由和寻址功能的」
- TCP协议头中游20个字节信息

|              | TCP                          | UDP                            |
| :----------- | ---------------------------- | ------------------------------ |
| 是否连接     | 面向连接                     | 无连接                         |
| 是否可靠     | 可靠，使用流量控制和拥塞控制 | 不可靠                         |
| 连接对象个数 | 一对一                       | 一对一、一对多、对多一、多对多 |
| 传输方式     | 面向字节                     | 面向报文                       |
| 首部开销     | 最小20字节，最大60字节       | 仅8个字节                      |
| 适用场景     | 文件传输                     | IP电话、视屏会议、直播         |



# 头部信息

## vary

 代理服务器需要带这个字段，否则可能存在缓存错乱，vary: accept-encoding;



# DNS

# CDN

